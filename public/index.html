<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>AP Eleme YarÄ±ÅŸÄ±</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/canvas-confetti/1.6.0/confetti.browser.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#f0f2f5; margin:0; padding:0; display:flex; justify-content:center; align-items:center; min-height:100vh; color:#333; }
    .container { width:100%; max-width:600px; background:white; padding:25px; border-radius:15px; box-shadow:0 10px 25px rgba(0,0,0,0.1); text-align: center; margin: 10px; }
    
    /* Butonlar */
    .btn { width:100%; padding:15px; margin-top:10px; font-size:18px; font-weight:bold; cursor:pointer; border-radius:10px; border:none; transition:0.2s; }
    .btn-blue { background:#007bff; color:white; }
    .btn-green { background:#28a745; color:white; }
    .btn-red { background:#dc3545; color:white; }
    .btn-dark { background:#343a40; color:white; }
    .btn:active { transform:scale(0.98); }

    /* Input */
    input { width:90%; padding:15px; border:2px solid #ddd; border-radius:10px; font-size:16px; text-align:center; margin-bottom:15px; outline:none; }
    input:focus { border-color:#007bff; }

    /* Oyun AlanÄ± */
    .question-box { background:#e9ecef; padding:20px; border-radius:10px; margin-bottom:20px; font-size:20px; font-weight:bold; }
    .option { background:white; border:2px solid #ddd; padding:15px; margin:10px 0; border-radius:10px; cursor:pointer; font-size:18px; transition:0.2s; }
    .option:hover { background:#f8f9fa; border-color:#aaa; }
    
    /* Admin Tablosu */
    table { width:100%; border-collapse:collapse; margin-top:15px; font-size:14px; }
    th, td { padding:10px; text-align:left; border-bottom:1px solid #ddd; }
    th { background:#f8f9fa; }
    .status-alive { color:#28a745; font-weight:bold; }
    .status-dead { color:#dc3545; text-decoration:line-through; }
    .status-win { color:#ffc107; font-weight:bold; }

    .hidden { display: none !important; }
    .badge { display:inline-block; padding:5px 10px; border-radius:20px; font-size:12px; font-weight:bold; background:#eee; }
  </style>
</head>
<body>

<div class="container">
  
  <!-- 1. GÄ°RÄ°Å EKRANI -->
  <div id="screen-login">
    <h2>ğŸš€ AP ELEME YARIÅI</h2>
    <p>AdÄ±nÄ± yaz ve yarÄ±ÅŸmaya katÄ±l!</p>
    <input id="username" placeholder="AdÄ±nÄ±z SoyadÄ±nÄ±z" />
    <button class="btn btn-blue" onclick="joinGame()">Ã–ÄRENCÄ° OLARAK KATIL</button>
    <div style="margin-top:30px; border-top:1px solid #eee; padding-top:20px;">
      <button class="btn btn-dark" style="font-size:14px; padding:10px;" onclick="joinAdmin()">Ã–ÄŸretmen GiriÅŸi (YÃ¶netici)</button>
    </div>
  </div>

  <!-- 2. BEKLEME EKRANI (Ã–ÄŸrenci) -->
  <div id="screen-wait" class="hidden">
    <h3>â³ HazÄ±r Ol!</h3>
    <p>Ã–ÄŸretmen oyunu baÅŸlattÄ±ÄŸÄ±nda sorular otomatik aÃ§Ä±lacak.</p>
    <div class="badge">BaÄŸlÄ± KiÅŸi SayÄ±sÄ±: <span id="player-count">0</span></div>
    <br><br>
    <img src="https://media.giphy.com/media/xTkcEQACH24SMPxIQg/giphy.gif" width="150" style="border-radius:10px;">
  </div>

  <!-- 3. Ã–ÄRETMEN PANELÄ° (Admin) -->
  <div id="screen-admin" class="hidden">
    <h3>ğŸ‘¨â€ğŸ« Ã–ÄRETMEN PANELÄ°</h3>
    <button id="start-btn" class="btn btn-green" onclick="startGame()">YARIÅI BAÅLAT ğŸ</button>
    <div style="margin-top:10px; text-align:left; max-height:400px; overflow-y:auto;">
      <table>
        <thead>
          <tr>
            <th>Ä°sim</th>
            <th>Durum</th>
            <th>Soru</th>
          </tr>
        </thead>
        <tbody id="admin-table-body">
          <!-- Oyuncular buraya gelecek -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- 4. OYUN EKRANI (Soru) -->
  <div id="screen-game" class="hidden">
    <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-weight:bold; color:#666;">
      <span id="q-counter">Soru 1</span>
      <span>HÄ±zlÄ± Ol!</span>
    </div>
    <div id="question-text" class="question-box">Soru YÃ¼kleniyor...</div>
    <div id="options-area"></div>
  </div>

  <!-- 5. ELENME EKRANI -->
  <div id="screen-eliminated" class="hidden">
    <h1 style="color:#dc3545;">ELENDÄ°N! ğŸ˜¢</h1>
    <p>YanlÄ±ÅŸ cevap verdin.</p>
    <p>DiÄŸerleri hala yarÄ±ÅŸÄ±yor, ekranÄ± kapatma, kazananÄ± bekle...</p>
  </div>

  <!-- 6. KAZANMA / BÄ°TÄ°Å EKRANI -->
  <div id="screen-result" class="hidden">
    <h1 id="winner-title" style="color:#28a745;"></h1>
    <p id="winner-msg"></p>
    <button class="btn btn-blue" onclick="location.reload()">Tekrar Oyna</button>
  </div>

</div>

<script>
  const socket = io();
  let myRole = "player";
  
  // SORULAR (Client sadece gÃ¶rsel olarak bunlarÄ± basacak, kontrol sunucuda)
  const questions = [
    { q: "Emziren kadÄ±nlarda Ã¶nerilmeyen yÃ¶ntem?", options: ["KOK", "RÄ°A", "Kondom", "POP"] },
    { q: "DoÄŸum sonrasÄ± hormonal yÃ¶ntem ne zaman baÅŸlanabilir?", options: ["Hemen", "6 hafta sonra", "1 yÄ±l sonra", "Asla"] },
    { q: "GenÃ§lerde CYBE iÃ§in en Ã¶nemli korunma yÃ¶ntemi?", options: ["RÄ°A", "Kondom", "Ligasyon", "Ä°mplant"] },
    { q: "Nullipar nedir?", options: ["DoÄŸum yapmamÄ±ÅŸ", "Ä°kiz doÄŸurmuÅŸ", "Menopozda", "Erkek partner"] },
    { q: "Acil kontrasepsiyon en etkilisi?", options: ["KOK", "BakÄ±rlÄ± RÄ°A", "DoÄŸal", "Takvim yÃ¶ntemi"] },
    { q: "Menopoz ortalama kaÃ§ yaÅŸ?", options: ["35", "42", "50", "58"] },
    { q: "AP Projesi baÅŸarÄ±yla tamamlandÄ± mÄ±?", options: ["HayÄ±r", "Belki", "EVET!", "SanmÄ±yorum"] }
  ];

  // --- GÄ°RÄ°Å Ä°ÅLEMLERÄ° ---
  function joinGame() {
    const name = document.getElementById("username").value;
    if(!name) return alert("LÃ¼tfen ismini yaz!");
    myRole = "player";
    socket.emit("joinGame", name);
    showScreen("screen-wait");
  }

  function joinAdmin() {
    myRole = "admin";
    socket.emit("joinAsAdmin");
    showScreen("screen-admin");
  }

  // --- ADMIN (Ã–ÄRETMEN) OLAYLARI ---
  function startGame() {
    socket.emit("startGame");
    document.getElementById("start-btn").innerText = "YarÄ±ÅŸ BaÅŸladÄ±... ğŸš€";
    document.getElementById("start-btn").disabled = true;
    document.getElementById("start-btn").style.background = "#555";
  }

  socket.on("adminData", (data) => {
    if(myRole !== "admin") return;
    
    const tbody = document.getElementById("admin-table-body");
    tbody.innerHTML = "";
    
    // Puanlamaya gÃ¶re (soru sayÄ±sÄ±na gÃ¶re) sÄ±rala
    const sortedPlayers = data.players.sort((a,b) => b.currentQuestionIndex - a.currentQuestionIndex);

    sortedPlayers.forEach(p => {
      let statusHtml = '<span class="status-alive">YarÄ±ÅŸÄ±yor</span>';
      if(p.eliminated) statusHtml = '<span class="status-dead">Elendi</span>';
      if(p.finished) statusHtml = '<span class="status-win">BÄ°TÄ°RDÄ°!</span>';

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><strong>${p.name}</strong></td>
        <td>${statusHtml}</td>
        <td>${p.currentQuestionIndex} / ${data.totalQuestions}</td>
      `;
      tbody.appendChild(tr);
    });
  });

  // --- OYUNCU (Ã–ÄRENCÄ°) OLAYLARI ---
  socket.on("playerCountUpdate", (count) => {
    document.getElementById("player-count").innerText = count;
  });

  socket.on("gameStarted", () => {
    if(myRole === "player") {
      showScreen("screen-game");
      loadQuestion(0);
    }
  });

  socket.on("nextQuestion", (index) => {
    loadQuestion(index);
  });

  socket.on("youAreEliminated", () => {
    showScreen("screen-eliminated");
  });

  socket.on("playerFinishedLate", () => {
    showScreen("screen-result");
    document.getElementById("winner-title").innerText = "Tebrikler!";
    document.getElementById("winner-msg").innerText = "TÃ¼m sorularÄ± bildin ama birinci olamadÄ±n.";
  });

  socket.on("gameOver", (data) => {
    // Sadece admin ve elenenler veya bitirenler iÃ§in final ekranÄ±
    // EÄŸer oyun oynuyorsan ve oyun bittiyse (birisi kazandÄ±ysa)
    if(myRole === "admin") {
      alert("Oyun Bitti! Kazanan: " + data.winnerName);
      return; 
    }

    showScreen("screen-result");
    if(data.winnerName) {
      document.getElementById("winner-title").innerText = "KAZANAN BELLÄ° OLDU!";
      document.getElementById("winner-msg").innerText = "ğŸ† ÅAMPÄ°YON: " + data.winnerName;
      confetti({ particleCount: 300, spread: 100, origin: { y: 0.6 } });
    }
  });

  // --- YARDIMCI FONKSÄ°YONLAR ---
  function loadQuestion(index) {
    if(index >= questions.length) return; // Hata Ã¶nleyici

    const q = questions[index];
    document.getElementById("q-counter").innerText = "Soru " + (index + 1);
    document.getElementById("question-text").innerText = q.q;
    
    const area = document.getElementById("options-area");
    area.innerHTML = "";

    q.options.forEach((opt, i) => {
      const btn = document.createElement("div");
      btn.className = "option";
      btn.innerText = opt;
      btn.onclick = () => {
        // CevabÄ± gÃ¶nder
        socket.emit("submitAnswer", i);
        // TÄ±klamayÄ± engelle (Ã§ift basmasÄ±n)
        area.style.pointerEvents = "none";
        btn.style.background = "#ffeeba"; // Bekleme rengi
      };
      area.appendChild(btn);
    });
    // AlanÄ± tekrar tÄ±klanabilir yap (yeni soru gelince)
    area.style.pointerEvents = "auto";
  }

  function showScreen(id) {
    // TÃ¼m ekranlarÄ± gizle
    document.querySelectorAll(".container > div").forEach(div => div.classList.add("hidden"));
    // Ä°stenilen ekranÄ± aÃ§
    document.getElementById(id).classList.remove("hidden");
  }

</script>

</body>
</html>



