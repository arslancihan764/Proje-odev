<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AP Eleme YarÄ±ÅŸÄ±</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/canvas-confetti/1.6.0/confetti.browser.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { font-family: sans-serif; background:#f4f4f4; text-align:center; padding:20px; }
    .container { max-width:500px; margin:0 auto; background:white; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
    .btn { width:100%; padding:15px; margin-top:10px; font-size:18px; cursor:pointer; border-radius:5px; border:none; }
    .correct { background:#d4edda !important; }
    .wrong { background:#f8d7da !important; }
    .hidden { display: none !important; }
    .option { background:#eee; padding:15px; margin:10px 0; cursor:pointer; border-radius:5px; }
  </style>
</head>
<body>
<div class="container">
  <h2>ğŸš€ AP YARIÅI</h2>

  <div id="login">
    <input id="name" placeholder="Ä°sim Giriniz" style="padding:10px; width:80%;" />
    <button class="btn" style="background:#007bff; color:white;" onclick="join()">YarÄ±ÅŸmaya KatÄ±l</button>
    <br><br>
    <button class="btn" style="background:#333; color:white; font-size:12px;" onclick="host()">Ã–ÄŸretmen GiriÅŸi</button>
  </div>

  <div id="wait" class="hidden">
    <h3>Bekleniyor...</h3>
    <p id="pCount">0 KiÅŸi</p>
    <div id="hostBtn" class="hidden">
      <button class="btn" style="background:green; color:white;" onclick="start()">BAÅLAT</button>
    </div>
  </div>

  <div id="game" class="hidden">
    <h3 id="qText">Soru...</h3>
    <div id="opts"></div>
  </div>

  <div id="result" class="hidden">
    <h1 id="resTitle"></h1>
    <p id="resMsg"></p>
  </div>
</div>

<script>
  const socket = io();
  let qIdx = 0;
  const qs = [
    {q:"Emziren kadÄ±nlarda Ã¶nerilmeyen yÃ¶ntem?", o:["KOK","RÄ°A","Kondom","POP"], a:0},
    {q:"DoÄŸum sonrasÄ± hormon ne zaman baÅŸlar?", o:["Hemen","6 hafta sonra","1 yÄ±l","Asla"], a:1},
    {q:"GenÃ§lerde CYBE iÃ§in en Ã¶nemli yÃ¶ntem?", o:["RÄ°A","Kondom","Ligasyon","Ä°mplant"], a:1},
    {q:"Nullipar nedir?", o:["DoÄŸum yapmamÄ±ÅŸ","Ä°kiz","Menopoz","Erkek"], a:0},
    {q:"Acil kontrasepsiyon en etkilisi?", o:["KOK","BakÄ±rlÄ± RÄ°A","DoÄŸal","Takvim"], a:1},
    {q:"Menopoz ortalama yaÅŸ?", o:["35","42","50","58"], a:2}
  ];

  function join(){
    const n = document.getElementById("name").value;
    if(!n) return alert("Ä°sim yaz!");
    socket.emit("joinGame", n);
    toWait();
  }
  function host(){
    document.getElementById("hostBtn").classList.remove("hidden");
    toWait();
    alert("Ã–ÄŸretmen modu devrede.");
  }
  function toWait(){
    document.getElementById("login").classList.add("hidden");
    document.getElementById("wait").classList.remove("hidden");
  }
  function start(){ socket.emit("hostStartGame"); }

  socket.on("updatePlayerCount", c => document.getElementById("pCount").innerText = c + " KiÅŸi");
  
  socket.on("gameStarted", () => {
    document.getElementById("wait").classList.add("hidden");
    document.getElementById("game").classList.remove("hidden");
    loadQ();
  });

  function loadQ(){
    if(qIdx>=qs.length){ socket.emit("playerFinished"); return; }
    document.getElementById("qText").innerText = qs[qIdx].q;
    const d = document.getElementById("opts"); d.innerHTML="";
    qs[qIdx].o.forEach((txt,i)=>{
      const b=document.createElement("div");
      b.className="option"; b.innerText=txt;
      b.onclick=()=>check(i, qs[qIdx].a, b);
      d.appendChild(b);
    });
  }

  function check(sel, corr, el){
    if(sel===corr){
      el.classList.add("correct");
      setTimeout(()=>{ qIdx++; loadQ(); },500);
    } else {
      el.classList.add("wrong");
      socket.emit("playerEliminated");
      end("ELENDÄ°N", "YanlÄ±ÅŸ cevap.");
    }
  }

  socket.on("gameOver", w => {
    const myName = document.getElementById("name").value;
    if(w===myName) {
      end("KAZANDIN! ğŸ†", "Tebrikler!");
      confetti();
    } else {
      end("BÄ°TTÄ°", "Kazanan: " + w);
    }
  });

  function end(t,m){
    document.getElementById("game").classList.add("hidden");
    document.getElementById("wait").classList.add("hidden");
    document.getElementById("result").classList.remove("hidden");
    document.getElementById("resTitle").innerText=t;
    document.getElementById("resMsg").innerText=m;
  }
</script>
</body>
</html>

